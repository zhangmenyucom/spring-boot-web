<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>自选股票</title>
    <script type="text/javascript" src="/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="/js/message-box.js"></script>
    <link href="/css/css.css" type="text/css" rel="stylesheet"/>
    <link href="/css/ligerui-all.css" rel="stylesheet" type="text/css"/>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            list-style: none;
            font-size: 14px;
        }

        body {
            text-align: center;
        }

        table {
            border-collapse: separate;
            /* margin: 0 auto;*/
            text-align: center;
        }

        table tr {
            word-break: keep-all; /*缩小不换行*/
        }

        table td, table th {
            border: 1px solid #cad9ea;
            color: black;
            height: 30px;
        }

        table thead th {
            background-color: #CCE8EB;
            width: 100%;
        }

        table tr:nth-child(odd) {
            background: #fff;
        }

        table tr:nth-child(even) {
            background: #F5FAFA;
        }

        .divOver {
            background: burlywood !important;
            border: solid 1px #d2dce3 !important;
        }

        #mouseover-showchart {
            float: left;
            display: none;
            position: fixed;
            background: lightgray;
            z-index: 99;
        }
    </style>
</head>
<body>
<div id="mouseover-showchart"></div>
<div id="container">
    <br/>
    <div>
        <ol style="list-style: none;display: block;float: none;-webkit-padding-start: 5px;">
            <li style="margin-right: 10px;float:left;">指数：</li>
            <li th:each="data: ${bigDataList}" style="margin-right: 10px;float:left;">
                <span th:attr="data-code=${#strings.toLowerCase(data.stockCode)}" class="show_time" th:text="@{${data.stockName}+':'+ ${#numbers.formatDecimal(data.netChangeRatio, 1, 2)+'%'}}" th:style="'color:'+${data.netChangeRatio>0?'red':'green'}"></span>
                <span th:attr="data-code=${#strings.toLowerCase(data.stockCode)}" class="show_kline" th:text="k" th:style="'color:'+${data.netChangeRatio>0?'red':'green'}"></span>
            </li>
            <li><input type="text" id="searchStock" placeholder="股票代码或名称"/><input type="button" id="add" value="添加自选"/></li>
        </ol>
    </div>
    <br/>
    <br/>
    <table>
        <tr>
            <th>股票代码</th>
            <th>股票名称</th>
            <th>资金流向</th>
            <th>公司业绩</th>
            <th>新闻热点</th>
            <th>行业</th>
            <th>地区</th>
            <th th:if="${found_view==1}">大单流入</th>
            <th th:if="${found_view==1}">中单流入</th>
            <th th:if="${found_view==1}">小单流入</th>
            <th>当日涨幅</th>
<!--
            <th>累计涨幅</th>
-->
            <th>操作</th>
<!--
            <th>关注价</th>
-->
            <th>当前价</th>
            <th>成本价</th>
            <th>差比</th>
            <th>入选理由</th>
            <th>星标</th>
        </tr>
        <tr th:each="stock: ${stockOnShelves}" th:attr="data-code=${#strings.toLowerCase(stock.stockCode)}">
            <td th:text="${#strings.substring(stock.stockCode,2)}" th:attr="data-code=${#strings.toLowerCase(stock.stockCode)}" class="show_time"></td>
            <td th:text="${stock.stockName}" th:attr="data-code=${#strings.toLowerCase(stock.stockCode)}" class="show_kline" style="font-weight:bold !important;"></td>
            <td><a class="dialog" target="_blank"  th:href="@{'http://stockpage.10jqka.com.cn/'+${#strings.substring(stock.stockCode,2)}+'/funds'}">资金流向</a></td>
            <td><a class="dialog" target="_blank" th:href="@{'http://basic.10jqka.com.cn/'+${#strings.substring(stock.stockCode,2)}}">公司业绩</a></td>
            <td><a class="dialog" target="_blank" th:href="@{'https://www.yuncaijing.com/quote/'+${#strings.toLowerCase(stock.stockCode)}+'.html'}">新闻热点</a></td>
            <td><a class="dialog" target="_blank"  th:href="@{'/stock/view/related/'+${stock.stockCode}}"> <span th:text="${stock.industry}"></span></a></td>
            <td><span th:text="${stock.district}"></span></td>
            <td th:if="${found_view==1}"><span th:text="${#numbers.formatDecimal(stock.foundInOutEntity.daDan,1,2)}" th:style="'color:'+${stock.foundInOutEntity.daDan>0?'red':'green'}"></span></td>
            <td th:if="${found_view==1}"><span th:text="${#numbers.formatDecimal(stock.foundInOutEntity.zhongDan,1,2)}" th:style="'color:'+${stock.foundInOutEntity.zhongDan>0?'red':'green'}"></span></td>
            <td th:if="${found_view==1}"><span th:text="${#numbers.formatDecimal(stock.foundInOutEntity.xiaoDan,1,2)}" th:style="'color:'+${stock.foundInOutEntity.xiaoDan>0?'red':'green'}"></span></td>
            <td th:text="${stock.netRatio!=null?#numbers.formatDecimal(stock.netRatio, 1, 2)+'%':'未更新'}"
                th:style="'color:'+${stock.netRatio>0?'red':'green'}"></td>
<!--            <td th:text="${#numbers.formatDecimal((stock.currentPrice - stock.focusPrice) * 100/stock.focusPrice,1,2)+'%'}"
                th:style="'color:'+${stock.currentPrice>stock.focusPrice?'red':'green'}"></td>-->
            <td>
                <button class="del-choose">删除</button>
                <button th:if="${stock.status==0 or stock.status==1}" class="update_btn" data-status="2">置顶</button>
                <button th:if="${stock.status==2}" class="update_btn" data-status="0"><img src="/images/common/top.gif"/></button>
                <button th:if="${stock.status==0 or stock.status==2}" class="star_btn" data-status="1">星标</button>
                <button th:if="${stock.status==1}" class="star_btn" data-status="0">已标</button>
            </td>
<!--
            <td th:text="${stock.focusPrice}"></td>
-->
            <td th:text="${stock.currentPrice}"></td>
            <td class="alter_cost_price" th:attr="data-code=${#strings.toLowerCase(stock.stockCode)}" th:text="${stock.costPrice}" th:style="'color:'+${stock.costPrice>stock.currentPrice?'red':'green'}"></td>
            <td><span th:if="${stock.costPrice!=null and stock.costPrice!=0}" th:text="${#numbers.formatDecimal((stock.currentPrice - stock.costPrice) * 100/stock.currentPrice,1,2)+'%'}" th:style="'color:'+${(stock.currentPrice - stock.costPrice) * 100/stock.currentPrice>=0?'red':'green'}+';font-weight:'+${((stock.currentPrice - stock.costPrice) * 100/stock.currentPrice>=0 and 1.5>=(stock.currentPrice - stock.costPrice) * 100/stock.currentPrice)? 'bold':'none;'}"></span></td>
            <td class="comment alter-comment" th:attr="data-code=${#strings.toLowerCase(stock.stockCode)}" th:text="${stock.reason}"></td>
            <td class="star"><img th:if="${stock.status==1}" src="/images/icon/star.png"/></td>
        </tr>
        <tr>
            <td colspan="18" cols="18">
                <div style="float: right;">共 <span th:text="${#lists.size(stockOnShelves)}"></span> 条数据</div>
            </td>
        </tr>
    </table>
    <div style="height: 300px;"></div>
</div>
<script type="text/javascript" src="/js/xui.js"></script>
<script type="text/javascript" src="/js/base.js"></script>
<script type="text/javascript" src="/js/ligerDialog.js"></script>
<script language="javascript">
    $(function () {
        //当鼠标滑入时将div的class换成divOver
        $('tr').hover(function () {
                $(this).addClass('divOver');
            }, function () {
                //鼠标离开时移除divOver样式
                $(this).removeClass('divOver');
            }
        );
        $(".del-choose").click(function () {
            var temp = $(this);
            $.ajax({
                url: "/stock/api/remove_choose",
                type: 'POST',
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify({
                    "stockCode": $(this).parent().parent().find("td").first().data("code")
                }),
                success: function (result) {
                    if (result.errorNo == 0) {
                        temp.parent().parent().hide();
                    }
                }
            });
        });
        $(".alter-comment").click(function () {
            var temp = $(this);
            $.ligerDialog.prompt('提示内容', true, function (yes, value) {
                $.ajax({
                    url: "/stock/api/alter",
                    type: 'POST',
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify({
                        "stockCode": temp.parent().find("td").first().data("code"),
                        "reason": value
                    }),
                    success: function (result) {
                        if (result.errorNo == 0) {
                            $.ligerDialog.success("sucess");
                            temp.html(value);
                        } else {
                            $.ligerDialog.success(result.errorMsg);
                        }
                    }
                });
            });
        });
        $(".alter_cost_price").click(function () {
            var temp = $(this);
            $.ligerDialog.prompt('输入成本价', true, function (yes, value) {
                $.ajax({
                    url: "/stock/api/alter",
                    type: 'POST',
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify({
                        "stockCode": temp.parent().find("td").first().data("code"),
                        "costPrice": value
                    }),
                    success: function (result) {
                        if (result.errorNo == 0) {
                            $.ligerDialog.success("sucess");
                            temp.text(value);
                        } else {
                            $.ligerDialog.success(result.errorMsg);
                        }
                    }
                });
            });
        });
        $(".update_btn").on("click", function () {
            var temp = $(this);
            $.ajax({
                url: "/stock/api/update_monitor",
                type: 'POST',
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify({
                    "stockCode": $(this).parent().parent().find("td").first().data("code"),
                    "status": $(this).data("status")
                }),
                success: function () {
                    if (temp.data("status") == "2") {
                        temp.data("status", "0");
                        temp.text("取消");
                        $.MsgBox.Alert("消息", "已置顶!");
                    } else {
                        temp.data("status", "2");
                        temp.text("置顶");
                        $.MsgBox.Alert("消息", "已取消!");
                    }
                }
            });
        });
    });
    $(".star_btn").on("click", function () {
        var temp = $(this);
        $.ajax({
            url: "/stock/api/update_monitor",
            type: 'POST',
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            data: JSON.stringify({
                "stockCode": $(this).parent().parent().find("td").first().data("code"),
                "status": $(this).data("status")
            }),
            success: function () {
                if (temp.data("status") == "1") {
                    temp.data("status", "1");
                    temp.text("已标");
                    $.MsgBox.Alert("消息", "已标记!");
                } else {
                    temp.data("status", "0");
                    temp.text("星标");
                    $.MsgBox.Alert("消息", "已取消标记!");
                }
            }
        });
    });

    function isChinese(temp) {
        var re = /.*[\u4e00-\u9fa5]+.*$/;
        return re.test(temp);
    }
    $("#add").click(function () {
        var stockCode=$("#searchStock").val();
        var stockName;
         if(isChinese(stockCode)){
             stockName=stockCode;
             stockCode=null;
         }else{
             stockCode=(stockCode[0]=="6"?("sh"+stockCode):("sz"+stockCode));
         }
        $.ligerDialog.prompt('提示内容', true, function (yes, value) {
            $.ajax({
                url: "/stock/api/add_choose",
                type: 'POST',
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify({
                    "stockCode":stockCode,
                    "stockName":stockName,
                    "costPrice": isNaN(value) ? null : value,
                    "status":2,
                    "reason": value
                }),
                success: function (result) {
                    if (result.errorNo == 0) {
                        $("#searchStock").val("");
                        $.ligerDialog.success("添加成功，查询请刷新");
                    } else {
                        $.ligerDialog.success(result.errorMsg);
                    }
                }
            });
        });
    });
</script>
</body>
</html>